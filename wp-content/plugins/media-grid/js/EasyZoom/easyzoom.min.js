(function(d){function b(a,c){this.$target=d(a);this.opts=d.extend({},n,c,this.$target.data());void 0===this.isOpen&&this._init()}var g,h,k,l,e,f,n={loadingNotice:"Loading image",errorNotice:"The image could not be loaded",errorDuration:2500,linkAttribute:"href",preventClicks:!0,beforeShow:d.noop,beforeHide:d.noop,onShow:d.noop,onHide:d.noop,onMove:d.noop};b.prototype._init=function(){this.$link=this.$target.find("a");this.$image=this.$target.find("img");this.$flyout=d('<div class="easyzoom-flyout" />');
this.$notice=d('<div class="easyzoom-notice" />');this.$target.on({"mousemove.easyzoom touchmove.easyzoom":d.proxy(this._onMove,this),"mouseleave.easyzoom touchend.easyzoom":d.proxy(this._onLeave,this),"mouseenter.easyzoom touchstart.easyzoom":d.proxy(this._onEnter,this)});this.opts.preventClicks&&this.$target.on("click.easyzoom",function(a){a.preventDefault()})};b.prototype.show=function(a,c){var d,b,e,f,m=this;if(!1!==this.opts.beforeShow.call(this)){if(!this.isReady)return this._loadImage(this.$link.attr(this.opts.linkAttribute),
function(){!m.isMouseOver&&c||m.show(a)});this.$target.append(this.$flyout);d=this.$target.width();b=this.$target.height();e=this.$flyout.width();f=this.$flyout.height();g=this.$zoom.width()-e;h=this.$zoom.height()-f;0>g&&(g=0);0>h&&(h=0);k=g/d;l=h/b;this.isOpen=!0;this.opts.onShow.call(this);a&&this._move(a)}};b.prototype._onEnter=function(a){var c=a.originalEvent.touches;this.isMouseOver=!0;c&&1!=c.length||(a.preventDefault(),this.show(a,!0))};b.prototype._onMove=function(a){this.isOpen&&(a.preventDefault(),
this._move(a))};b.prototype._onLeave=function(){this.isMouseOver=!1;this.isOpen&&this.hide()};b.prototype._onLoad=function(a){a.currentTarget.width&&(this.isReady=!0,this.$notice.detach(),this.$flyout.html(this.$zoom),this.$target.removeClass("is-loading").addClass("is-ready"),a.data.call&&a.data())};b.prototype._onError=function(){var a=this;this.$notice.text(this.opts.errorNotice);this.$target.removeClass("is-loading").addClass("is-error");this.detachNotice=setTimeout(function(){a.$notice.detach();
a.detachNotice=null},this.opts.errorDuration)};b.prototype._loadImage=function(a,c){var b=new Image;this.$target.addClass("is-loading").append(this.$notice.text(this.opts.loadingNotice));this.$zoom=d(b).on("error",d.proxy(this._onError,this)).on("load",c,d.proxy(this._onLoad,this));b.style.position="absolute";b.src=a};b.prototype._move=function(a){0===a.type.indexOf("touch")?(a=a.touches||a.originalEvent.touches,e=a[0].pageX,f=a[0].pageY):(e=a.pageX||e,f=a.pageY||f);var c=this.$target.offset();a=
Math.ceil((f-c.top)*l);c=Math.ceil((e-c.left)*k);0>c||0>a||c>g||a>h?this.hide():(a*=-1,c*=-1,this.$zoom.css({top:a,left:c}),this.opts.onMove.call(this,a,c))};b.prototype.hide=function(){this.isOpen&&!1!==this.opts.beforeHide.call(this)&&(this.$flyout.detach(),this.isOpen=!1,this.opts.onHide.call(this))};b.prototype.swap=function(a,c,b){this.hide();this.isReady=!1;this.detachNotice&&clearTimeout(this.detachNotice);this.$notice.parent().length&&this.$notice.detach();this.$target.removeClass("is-loading is-ready is-error");
this.$image.attr({src:a,srcset:d.isArray(b)?b.join():b});this.$link.attr(this.opts.linkAttribute,c)};b.prototype.teardown=function(){this.hide();this.$target.off(".easyzoom").removeClass("is-loading is-ready is-error");this.detachNotice&&clearTimeout(this.detachNotice);delete this.$link;delete this.$zoom;delete this.$image;delete this.$notice;delete this.$flyout;delete this.isOpen;delete this.isReady};d.fn.easyZoom=function(a){return this.each(function(){var c=d.data(this,"easyZoom");c?void 0===c.isOpen&&
c._init():d.data(this,"easyZoom",new b(this,a))})};"function"===typeof define&&define.amd?define(function(){return b}):"undefined"!==typeof module&&module.exports&&(module.exports=b)})(jQuery);